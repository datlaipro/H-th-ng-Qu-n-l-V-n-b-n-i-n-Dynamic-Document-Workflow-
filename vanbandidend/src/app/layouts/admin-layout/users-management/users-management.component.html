<div class="page">
  <!-- Header row -->
  <div class="header">
    <h1>Users Management</h1>

    <div class="header-actions">
      <button mat-stroked-button (click)="exportCsv()">
        <mat-icon>ios_share</mat-icon>
        Export
      </button>
      <button mat-raised-button color="primary" class="btn-add" (click)="addUser()">
        <mat-icon>add</mat-icon>
        Add New User
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <nav class="tabs">
    <button class="tab active">All Users</button>
    <button class="tab">Teams</button>
    <button class="tab">Roles and Permissions</button>
    <button class="tab">Invitations</button>
    <button class="tab">Activity Logs</button>
  </nav>

  <!-- Toolbar: search + filter -->
  <div class="toolbar">
    <mat-form-field appearance="outline" class="search">
      <mat-icon matPrefix>search</mat-icon>
      <input matInput placeholder="Search..." (input)="search.set($any($event.target).value)" />
    </mat-form-field>

    <button mat-button [matMenuTriggerFor]="filterMenu">
      <mat-icon>tune</mat-icon>
      Filter
    </button>
    <mat-menu #filterMenu="matMenu">
      <button mat-menu-item (click)="showOnly('all')">All</button>
      <button mat-menu-item (click)="showOnly('Active')">Active</button>
      <button mat-menu-item (click)="showOnly('In Active')">In Active</button>
      <button mat-menu-item (click)="showOnly('On Hold')">On Hold</button>
      <button mat-menu-item (click)="showOnly('To Be Verified')">To Be Verified</button>
    </mat-menu>
  </div>

  <!-- Table card -->
  <div class="surface card-elev">
    <table mat-table [dataSource]="dataSource" matSort class="users-table">

      <!-- Select -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox (change)="masterToggle()" [checked]="isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected()"></mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox (click)="$event.stopPropagation()"
                        (change)="$event ? selection.toggle(row) : null"
                        [checked]="selection.isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- User -->
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>User</th>
        <td mat-cell *matCellDef="let row">
          <div class="user-cell">
            <div class="avatar">{{ row.name[0] }}</div>
            <div class="meta">
              <div class="name">{{ row.name }}</div>
              <div class="email">{{ row.email }}</div>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Role -->
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Role</th>
        <td mat-cell *matCellDef="let row">{{ row.role }}</td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status <mat-icon class="arrow">arrow_drop_down</mat-icon></th>
        <td mat-cell *matCellDef="let row">
          <span class="status-chip" [class.success]="statusChipColor(row.status)==='success'"
                                    [class.warning]="statusChipColor(row.status)==='warning'"
                                    [class.hold]="statusChipColor(row.status)==='hold'"
                                    [class.danger]="statusChipColor(row.status)==='danger'">
            <span class="dot"></span>{{ row.status }}
          </span>
        </td>
      </ng-container>

      <!-- Last Modified -->
      <ng-container matColumnDef="lastModified">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Modified</th>
        <td mat-cell *matCellDef="let row">{{ row.lastModifiedAgo }}</td>
      </ng-container>

      <!-- Last Login -->
      <ng-container matColumnDef="lastLogin">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Login</th>
        <td mat-cell *matCellDef="let row">{{ row.lastLoginAgo }}</td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row" class="actions">
          <button mat-icon-button matTooltip="Edit" (click)="edit(row)"><mat-icon>edit</mat-icon></button>
          <button mat-icon-button matTooltip="Delete" (click)="remove(row)"><mat-icon>delete</mat-icon></button>
        </td>
      </ng-container>

      <!-- Header & Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="thead"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="trow"></tr>

    </table>

    <mat-paginator [pageSize]="8" [pageSizeOptions]="[8,10,20,50]" showFirstLastButtons></mat-paginator>
  </div>
</div>
