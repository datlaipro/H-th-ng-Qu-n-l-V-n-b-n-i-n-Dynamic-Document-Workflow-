<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                             http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1">

  <display-name>zkapi</display-name>

  <!-- Session dùng cookie -->
<session-config>
  <session-timeout>60</session-timeout>

  <cookie-config>
    <!-- Các field nhận dạng đặt TRƯỚC -->
    <name>JSESSIONID</name>
    <!-- optional: <domain>your-domain.com</domain> -->
    <path>/</path>
    <!-- optional: <comment>Session cookie</comment> -->

    <!-- Các flag bảo mật đặt SAU -->
    <http-only>true</http-only>
    <!-- Prod HTTPS thì mở dòng dưới -->
    <!-- <secure>true</secure> -->
    <!-- optional: <max-age>1800</max-age> -->
  </cookie-config>

  <tracking-mode>COOKIE</tracking-mode>
</session-config>



  <!-- ===== CORS cho API (nếu FE khác origin) ===== -->
  <filter>
    <filter-name>CorsFilter</filter-name>
    <filter-class>org.apache.catalina.filters.CorsFilter</filter-class>
    <init-param>
      <param-name>cors.allowed.origins</param-name>
      <param-value>http://localhost:4200, https://your-fe-domain.com</param-value>
    </init-param>
    <init-param>
      <param-name>cors.allowed.methods</param-name>
      <param-value>GET,POST,PUT,PATCH,DELETE,OPTIONS</param-value>
    </init-param>
    <init-param>
      <param-name>cors.allowed.headers</param-name>
      <param-value>Content-Type, X-Requested-With, X-XSRF-TOKEN</param-value>
    </init-param>
    <init-param>
      <param-name>cors.exposed.headers</param-name>
      <param-value>Set-Cookie</param-value>
    </init-param>
    <init-param>
      <param-name>cors.support.credentials</param-name>
      <param-value>true</param-value>
    </init-param>
  </filter>
  <filter-mapping>
    <filter-name>CorsFilter</filter-name>
    <url-pattern>/api/*</url-pattern>
  </filter-mapping>

  <!-- ===== CSRF Filter (khuyến nghị) =====
       Triển khai lớp your.pkg.security.CsrfFilter như mình gửi ở trên,
       kiểm tra Origin/Referer + header X-XSRF-TOKEN cho POST/PUT/PATCH/DELETE.
  -->
  <!-- <filter>
    <filter-name>CsrfFilter</filter-name>
    <filter-class>your.pkg.security.CsrfFilter</filter-class>
  </filter>
  <filter-mapping>
    <filter-name>CsrfFilter</filter-name>
    <url-pattern>/api/*</url-pattern>
  </filter-mapping> -->

  <!-- ===== ZK servlet mapping cơ bản (nếu bạn có UI ZK *.zul) ===== -->
  <servlet>
    <servlet-name>zkLoader</servlet-name>
    <servlet-class>org.zkoss.zk.ui.http.DHtmlLayoutServlet</servlet-class>
    <init-param>
      <param-name>update-uri</param-name>
      <param-value>/zkau</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
  </servlet>
  <servlet-mapping>
    <servlet-name>zkLoader</servlet-name>
    <url-pattern>*.zul</url-pattern>
  </servlet-mapping>

  <servlet>
    <servlet-name>auEngine</servlet-name>
    <servlet-class>org.zkoss.zk.au.http.DHtmlUpdateServlet</servlet-class>
  </servlet>
  <servlet-mapping>
    <servlet-name>auEngine</servlet-name>
    <url-pattern>/zkau/*</url-pattern>
  </servlet-mapping>
<welcome-file-list>
  <welcome-file>index.zul</welcome-file>
</welcome-file-list>

  <!-- API của bạn (Servlet/REST) nên đặt dưới /api/* -->
</web-app>
